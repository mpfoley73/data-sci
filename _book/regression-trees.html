<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.2 Regression Trees | My Data Science Notes</title>
  <meta name="description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="8.2 Regression Trees | My Data Science Notes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.2 Regression Trees | My Data Science Notes" />
  
  <meta name="twitter:description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  

<meta name="author" content="Michael Foley" />


<meta name="date" content="2020-01-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="classification-tree.html"/>
<link rel="next" href="bagging.html"/>
<script src="assets/jquery-2.2.3/jquery.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="1" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>1</b> Probability</a><ul>
<li class="chapter" data-level="1.1" data-path="principles.html"><a href="principles.html"><i class="fa fa-check"></i><b>1.1</b> Principles</a></li>
<li class="chapter" data-level="1.2" data-path="discrete-distributions.html"><a href="discrete-distributions.html"><i class="fa fa-check"></i><b>1.2</b> Discrete Distributions</a><ul>
<li class="chapter" data-level="1.2.1" data-path="discrete-distributions.html"><a href="discrete-distributions.html#binomial"><i class="fa fa-check"></i><b>1.2.1</b> Binomial</a></li>
<li class="chapter" data-level="1.2.2" data-path="discrete-distributions.html"><a href="discrete-distributions.html#negative-binomial"><i class="fa fa-check"></i><b>1.2.2</b> Negative-Binomial</a></li>
<li class="chapter" data-level="1.2.3" data-path="discrete-distributions.html"><a href="discrete-distributions.html#geometric"><i class="fa fa-check"></i><b>1.2.3</b> Geometric</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="continuous-distributions.html"><a href="continuous-distributions.html"><i class="fa fa-check"></i><b>1.3</b> Continuous Distributions</a><ul>
<li class="chapter" data-level="1.3.1" data-path="continuous-distributions.html"><a href="continuous-distributions.html#normal"><i class="fa fa-check"></i><b>1.3.1</b> Normal</a></li>
<li class="chapter" data-level="1.3.2" data-path="continuous-distributions.html"><a href="continuous-distributions.html#example-1"><i class="fa fa-check"></i><b>1.3.2</b> Example</a></li>
<li class="chapter" data-level="1.3.3" data-path="continuous-distributions.html"><a href="continuous-distributions.html#example-2"><i class="fa fa-check"></i><b>1.3.3</b> Example</a></li>
<li class="chapter" data-level="1.3.4" data-path="continuous-distributions.html"><a href="continuous-distributions.html#example-3"><i class="fa fa-check"></i><b>1.3.4</b> Example</a></li>
<li class="chapter" data-level="1.3.5" data-path="continuous-distributions.html"><a href="continuous-distributions.html#normal-approximation-to-binomial"><i class="fa fa-check"></i><b>1.3.5</b> Normal Approximation to Binomial</a></li>
<li class="chapter" data-level="1.3.6" data-path="continuous-distributions.html"><a href="continuous-distributions.html#example-4"><i class="fa fa-check"></i><b>1.3.6</b> Example</a></li>
<li class="chapter" data-level="1.3.7" data-path="continuous-distributions.html"><a href="continuous-distributions.html#example-5"><i class="fa fa-check"></i><b>1.3.7</b> Example</a></li>
<li class="chapter" data-level="1.3.8" data-path="continuous-distributions.html"><a href="continuous-distributions.html#from-sample-to-population"><i class="fa fa-check"></i><b>1.3.8</b> From Sample to Population</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="inference.html"><a href="inference.html"><i class="fa fa-check"></i><b>2</b> Inference</a></li>
<li class="chapter" data-level="3" data-path="experiments.html"><a href="experiments.html"><i class="fa fa-check"></i><b>3</b> Experiments</a><ul>
<li class="chapter" data-level="3.1" data-path="example-one.html"><a href="example-one.html"><i class="fa fa-check"></i><b>3.1</b> Example one</a></li>
<li class="chapter" data-level="3.2" data-path="example-two.html"><a href="example-two.html"><i class="fa fa-check"></i><b>3.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="regression.html"><a href="regression.html"><i class="fa fa-check"></i><b>4</b> Regression</a></li>
<li class="chapter" data-level="5" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>5</b> Classification</a></li>
<li class="chapter" data-level="6" data-path="regularization.html"><a href="regularization.html"><i class="fa fa-check"></i><b>6</b> Regularization</a></li>
<li class="chapter" data-level="7" data-path="non-linear-models.html"><a href="non-linear-models.html"><i class="fa fa-check"></i><b>7</b> Non-linear Models</a><ul>
<li class="chapter" data-level="7.1" data-path="splines.html"><a href="splines.html"><i class="fa fa-check"></i><b>7.1</b> Splines</a></li>
<li class="chapter" data-level="7.2" data-path="mars.html"><a href="mars.html"><i class="fa fa-check"></i><b>7.2</b> MARS</a></li>
<li class="chapter" data-level="7.3" data-path="gam.html"><a href="gam.html"><i class="fa fa-check"></i><b>7.3</b> GAM</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="decision-trees.html"><a href="decision-trees.html"><i class="fa fa-check"></i><b>8</b> Decision Trees</a><ul>
<li class="chapter" data-level="8.1" data-path="classification-tree.html"><a href="classification-tree.html"><i class="fa fa-check"></i><b>8.1</b> Classification Tree</a><ul>
<li class="chapter" data-level="8.1.1" data-path="classification-tree.html"><a href="classification-tree.html#confusion-matrix"><i class="fa fa-check"></i><b>8.1.1</b> Confusion Matrix</a></li>
<li class="chapter" data-level="8.1.2" data-path="classification-tree.html"><a href="classification-tree.html#roc-curve"><i class="fa fa-check"></i><b>8.1.2</b> ROC Curve</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression-trees.html"><a href="regression-trees.html"><i class="fa fa-check"></i><b>8.2</b> Regression Trees</a></li>
<li class="chapter" data-level="8.3" data-path="bagging.html"><a href="bagging.html"><i class="fa fa-check"></i><b>8.3</b> Bagging</a></li>
<li class="chapter" data-level="8.4" data-path="random-forests.html"><a href="random-forests.html"><i class="fa fa-check"></i><b>8.4</b> Random Forests</a></li>
<li class="chapter" data-level="8.5" data-path="gradient-boosting.html"><a href="gradient-boosting.html"><i class="fa fa-check"></i><b>8.5</b> Gradient Boosting</a></li>
<li class="chapter" data-level="8.6" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>9</b> Reference</a></li>
<li class="chapter" data-level="10" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>10</b> Support Vector Machines</a></li>
<li class="chapter" data-level="11" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html"><i class="fa fa-check"></i><b>11</b> Principal Components Analysis</a></li>
<li class="chapter" data-level="12" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>12</b> Clustering</a></li>
<li class="chapter" data-level="13" data-path="text-mining.html"><a href="text-mining.html"><i class="fa fa-check"></i><b>13</b> Text Mining</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a></li>
<li class="chapter" data-level="" data-path="publishing-to-bookdown.html"><a href="publishing-to-bookdown.html"><i class="fa fa-check"></i>Publishing to BookDown</a></li>
<li class="chapter" data-level="" data-path="shiny-apps.html"><a href="shiny-apps.html"><i class="fa fa-check"></i>Shiny Apps</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">My Data Science Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="regression-trees" class="section level2">
<h2><span class="header-section-number">8.2</span> Regression Trees</h2>
<p>A simple regression tree is built the same way as a simple classificatioon tree. Like the simple classification tree, it is rarely invoked on its own; the bagged, random forest, and gradient boosting methods build on this logic.</p>
<div id="example-6" class="section level4">
<h4><span class="header-section-number">8.2.0.1</span> Example</h4>
<p>Using the <code>Carseats</code> data set from <code>ISLR</code>, I’ll predict <code>Sales</code> using the available feature variables.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="regression-trees.html#cb58-1"></a>carseats_dat &lt;-<span class="st"> </span>Carseats</span>
<span id="cb58-2"><a href="regression-trees.html#cb58-2"></a><span class="kw">skim_to_wide</span>(carseats_dat)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 10
##    type  variable missing complete n     n_unique top_counts ordered mean 
##    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;
##  1 fact~ ShelveL~ 0       400      400   3        Med: 219,~ FALSE   &lt;NA&gt; 
##  2 fact~ Urban    0       400      400   2        Yes: 282,~ FALSE   &lt;NA&gt; 
##  3 fact~ US       0       400      400   2        Yes: 258,~ FALSE   &lt;NA&gt; 
##  4 nume~ Adverti~ 0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot;  6~
##  5 nume~ Age      0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot; 53~
##  6 nume~ CompPri~ 0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    124.~
##  7 nume~ Educati~ 0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot; 13~
##  8 nume~ Income   0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot; 68~
##  9 nume~ Populat~ 0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    264.~
## 10 nume~ Price    0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot;115~
## 11 nume~ Sales    0       400      400   &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;    &quot;  7~
## # ... with 1 more variable: sd &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="regression-trees.html#cb60-1"></a>partition &lt;-<span class="st"> </span><span class="kw">createDataPartition</span>(<span class="dt">y =</span> carseats_dat<span class="op">$</span>Sales, <span class="dt">p =</span> <span class="fl">0.8</span>, <span class="dt">list =</span> <span class="ot">FALSE</span>)</span>
<span id="cb60-2"><a href="regression-trees.html#cb60-2"></a>carseats.train &lt;-<span class="st"> </span>carseats_dat[partition, ]</span>
<span id="cb60-3"><a href="regression-trees.html#cb60-3"></a>carseats.test &lt;-<span class="st"> </span>carseats_dat[<span class="op">-</span>partition, ]</span>
<span id="cb60-4"><a href="regression-trees.html#cb60-4"></a><span class="kw">rm</span>(partition)</span></code></pre></div>
<p>The first step is to build a full tree, then perform k-fold cross-validation to help select the optimal cost complexity (<span class="math inline">\(cp\)</span>). The only difference here is the <code>rpart()</code> parameter <code>method = "anova"</code> to produce a regression tree.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="regression-trees.html#cb61-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb61-2"><a href="regression-trees.html#cb61-2"></a><span class="co"># Specify model = TRUE to handle plotting splits with factor variables.</span></span>
<span id="cb61-3"><a href="regression-trees.html#cb61-3"></a>carseats.full_anova &lt;-<span class="st"> </span><span class="kw">rpart</span>(<span class="dt">formula =</span> Sales <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb61-4"><a href="regression-trees.html#cb61-4"></a>                             <span class="dt">data =</span> carseats.train,</span>
<span id="cb61-5"><a href="regression-trees.html#cb61-5"></a>                             <span class="dt">method =</span> <span class="st">&quot;anova&quot;</span>, </span>
<span id="cb61-6"><a href="regression-trees.html#cb61-6"></a>                             <span class="dt">xval =</span> <span class="dv">10</span>,</span>
<span id="cb61-7"><a href="regression-trees.html#cb61-7"></a>                             <span class="dt">model =</span> <span class="ot">TRUE</span>)</span>
<span id="cb61-8"><a href="regression-trees.html#cb61-8"></a><span class="kw">rpart.plot</span>(carseats.full_anova, <span class="dt">yesno =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="regression-trees.html#cb62-1"></a><span class="kw">printcp</span>(carseats.full_anova)</span></code></pre></div>
<pre><code>## 
## Regression tree:
## rpart(formula = Sales ~ ., data = carseats.train, method = &quot;anova&quot;, 
##     model = TRUE, xval = 10)
## 
## Variables actually used in tree construction:
## [1] Advertising Age         CompPrice   Education   Income      Price      
## [7] ShelveLoc  
## 
## Root node error: 2686.8/321 = 8.37
## 
## n= 321 
## 
##          CP nsplit rel error  xerror     xstd
## 1  0.267943      0   1.00000 1.00540 0.078263
## 2  0.088532      1   0.73206 0.74208 0.056780
## 3  0.065219      2   0.64353 0.71827 0.052070
## 4  0.042189      3   0.57831 0.68319 0.051263
## 5  0.025284      4   0.53612 0.66436 0.050684
## 6  0.025152      5   0.51083 0.64727 0.048558
## 7  0.021135      7   0.46053 0.64885 0.047632
## 8  0.020604      8   0.43939 0.63486 0.045827
## 9  0.018236      9   0.41879 0.63459 0.045611
## 10 0.017199     10   0.40055 0.64255 0.046307
## 11 0.013819     11   0.38335 0.65194 0.046275
## 12 0.012500     12   0.36953 0.63185 0.045019
## 13 0.012127     13   0.35703 0.62789 0.044142
## 14 0.011236     14   0.34491 0.62535 0.044194
## 15 0.010000     15   0.33367 0.62353 0.044238</code></pre>
<p>The algorithm included 9 variables in the full tree.</p>
<p>The second step is to prune the tree to avoid overfitting. The CP table shows the relavent statistics to choose the appropriate pruning paramter. The CP table is included in the model summary. The <code>rel error</code> column is the error rate / root node error produced when pruning the tree using complexity parameter <code>CP</code> to <code>nsplits</code> splits. The <code>xerror</code> column shows the error rate. A plot of <code>xerror</code> vs <code>cp</code> shows the relationship.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="regression-trees.html#cb64-1"></a><span class="kw">plotcp</span>(carseats.full_anova)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>In this case, the smallest relative error is at 0.01, but the maximum CP below the dashed line (one standard deviation above the mimimum error) is at <code>cp ~ .039</code>.Use the <code>prune()</code> function to prune the tree by specifying the associated cost-complexity <code>cp</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="regression-trees.html#cb65-1"></a>carseats.anova &lt;-<span class="st"> </span><span class="kw">prune</span>(carseats.full_anova, </span>
<span id="cb65-2"><a href="regression-trees.html#cb65-2"></a>                        <span class="dt">cp =</span> <span class="fl">0.039</span>)</span>
<span id="cb65-3"><a href="regression-trees.html#cb65-3"></a><span class="kw">rpart.plot</span>(carseats.anova, <span class="dt">yesno =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="regression-trees.html#cb66-1"></a><span class="kw">rm</span>(carseats.full_anova)</span></code></pre></div>
<p>The pruned tree has 9 variables. The most important indicator of <code>Sales</code> is shelving location.</p>
<p>The third and last step is to make predictions on the validation data set and record the root mean squared error (RMSE) for comparison to other models. The root mean squared error (<span class="math inline">\(RMSE = \sqrt{(1/2) \sum{(actual - pred)^2}})\)</span> and mean absolute error (<span class="math inline">\(MAE = (1/n) \sum{|actual - pred|}\)</span>) are the two most common measures of predictive accuracy. The key difference is that RMSE punishes large errors more harshly. For a regression tree, set argument <code>type = "vector"</code> (or do not specify at all).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="regression-trees.html#cb67-1"></a>carseats.anova.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(carseats.anova, carseats.test, <span class="dt">type =</span> <span class="st">&quot;vector&quot;</span>)</span>
<span id="cb67-2"><a href="regression-trees.html#cb67-2"></a><span class="kw">plot</span>(carseats.test<span class="op">$</span>Sales, carseats.anova.pred, </span>
<span id="cb67-3"><a href="regression-trees.html#cb67-3"></a>     <span class="dt">main =</span> <span class="st">&quot;Simple Regression: Predicted vs. Actual&quot;</span>,</span>
<span id="cb67-4"><a href="regression-trees.html#cb67-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Actual&quot;</span>,</span>
<span id="cb67-5"><a href="regression-trees.html#cb67-5"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Predicted&quot;</span>)</span>
<span id="cb67-6"><a href="regression-trees.html#cb67-6"></a><span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="regression-trees.html#cb68-1"></a>(carseats.anova.rmse &lt;-<span class="st"> </span><span class="kw">RMSE</span>(<span class="dt">pred =</span> carseats.anova.pred,</span>
<span id="cb68-2"><a href="regression-trees.html#cb68-2"></a>                            <span class="dt">obs =</span> carseats.test<span class="op">$</span>Sales))</span></code></pre></div>
<pre><code>## [1] 2.207922</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="regression-trees.html#cb70-1"></a><span class="kw">rm</span>(carseats.anova.pred)</span></code></pre></div>
<p>The pruning process leads to an average prediction error of 2.208 in the test data set. Not too bad considering the standard deviation of <code>Sales</code> is 2.517.</p>
<p>All of this can happen more or less automatically with the <code>caret::train()</code> function, specifying <code>method = "rpart"</code> and specifying either <code>tuneLength</code> or <code>tuneGrid</code>.</p>
<p>I’ll do this with <code>tuneLength</code> first.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="regression-trees.html#cb71-1"></a>carseats.anova2 =<span class="st"> </span><span class="kw">train</span>(Sales <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb71-2"><a href="regression-trees.html#cb71-2"></a>                    <span class="dt">data =</span> carseats.train, </span>
<span id="cb71-3"><a href="regression-trees.html#cb71-3"></a>                    <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,  <span class="co"># for classification tree</span></span>
<span id="cb71-4"><a href="regression-trees.html#cb71-4"></a>                    <span class="dt">tuneLength =</span> <span class="dv">5</span>,  <span class="co"># choose up to 5 combinations of tuning parameters (cp)</span></span>
<span id="cb71-5"><a href="regression-trees.html#cb71-5"></a>                    <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>,  <span class="co"># evaluate hyperparamter combinations with RMSE</span></span>
<span id="cb71-6"><a href="regression-trees.html#cb71-6"></a>                    <span class="dt">trControl =</span> <span class="kw">trainControl</span>(</span>
<span id="cb71-7"><a href="regression-trees.html#cb71-7"></a>                      <span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>,  <span class="co"># k-fold cross validation</span></span>
<span id="cb71-8"><a href="regression-trees.html#cb71-8"></a>                      <span class="dt">number =</span> <span class="dv">10</span>,  <span class="co"># 10 folds</span></span>
<span id="cb71-9"><a href="regression-trees.html#cb71-9"></a>                      <span class="dt">savePredictions =</span> <span class="st">&quot;final&quot;</span>       <span class="co"># save predictions for the optimal tuning parameter</span></span>
<span id="cb71-10"><a href="regression-trees.html#cb71-10"></a>                      )</span>
<span id="cb71-11"><a href="regression-trees.html#cb71-11"></a>                    )</span></code></pre></div>
<pre><code>## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info =
## trainInfo, : There were missing values in resampled performance measures.</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="regression-trees.html#cb73-1"></a>carseats.anova2</span></code></pre></div>
<pre><code>## CART 
## 
## 321 samples
##  10 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 289, 289, 289, 288, 289, 289, ... 
## Resampling results across tuning parameters:
## 
##   cp          RMSE      Rsquared   MAE     
##   0.02528421  2.260357  0.4063269  1.822658
##   0.04218949  2.310752  0.3743082  1.857423
##   0.06521890  2.402761  0.3207289  1.952247
##   0.08853191  2.441280  0.2983654  2.000816
##   0.26794258  2.764523  0.1927982  2.231786
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was cp = 0.02528421.</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="regression-trees.html#cb75-1"></a><span class="kw">plot</span>(carseats.anova2)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="regression-trees.html#cb76-1"></a>carseats.anova.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(carseats.anova2, carseats.test, <span class="dt">type =</span> <span class="st">&quot;raw&quot;</span>)</span>
<span id="cb76-2"><a href="regression-trees.html#cb76-2"></a><span class="kw">plot</span>(carseats.test<span class="op">$</span>Sales, carseats.anova.pred, </span>
<span id="cb76-3"><a href="regression-trees.html#cb76-3"></a>     <span class="dt">main =</span> <span class="st">&quot;Simple Regression: Predicted vs. Actual&quot;</span>,</span>
<span id="cb76-4"><a href="regression-trees.html#cb76-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Actual&quot;</span>,</span>
<span id="cb76-5"><a href="regression-trees.html#cb76-5"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Predicted&quot;</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-44-2.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="regression-trees.html#cb77-1"></a>(carseats.anova.rmse2 &lt;-<span class="st"> </span><span class="kw">RMSE</span>(<span class="dt">pred =</span> carseats.anova.pred,</span>
<span id="cb77-2"><a href="regression-trees.html#cb77-2"></a>                             <span class="dt">obs =</span> carseats.test<span class="op">$</span>Sales))</span></code></pre></div>
<pre><code>## [1] 2.207922</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="regression-trees.html#cb79-1"></a><span class="kw">rm</span>(oj.class.pred)</span></code></pre></div>
<pre><code>## Warning in rm(oj.class.pred): object &#39;oj.class.pred&#39; not found</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="regression-trees.html#cb81-1"></a><span class="kw">rpart.plot</span>(carseats.anova2<span class="op">$</span>finalModel)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-44-3.png" width="672" /></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="regression-trees.html#cb82-1"></a><span class="kw">plot</span>(<span class="kw">varImp</span>(carseats.anova2), <span class="dt">main=</span><span class="st">&quot;Variable Importance with Simple Regression&quot;</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-44-4.png" width="672" /></p>
<p>Now with <code>tuneGrid</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="regression-trees.html#cb83-1"></a>myGrid &lt;-<span class="st">  </span><span class="kw">expand.grid</span>(<span class="dt">cp =</span> (<span class="dv">0</span><span class="op">:</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">10</span>)</span>
<span id="cb83-2"><a href="regression-trees.html#cb83-2"></a>carseats.anova3 =<span class="st"> </span><span class="kw">train</span>(Sales <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb83-3"><a href="regression-trees.html#cb83-3"></a>                    <span class="dt">data =</span> carseats.train, </span>
<span id="cb83-4"><a href="regression-trees.html#cb83-4"></a>                    <span class="dt">method =</span> <span class="st">&quot;rpart&quot;</span>,  <span class="co"># for classification tree</span></span>
<span id="cb83-5"><a href="regression-trees.html#cb83-5"></a>                    <span class="dt">tuneGrid =</span> myGrid,  <span class="co"># choose up to 5 combinations of tuning parameters (cp)</span></span>
<span id="cb83-6"><a href="regression-trees.html#cb83-6"></a>                    <span class="dt">metric =</span> <span class="st">&quot;RMSE&quot;</span>,  <span class="co"># evaluate hyperparamter combinations with RMSE</span></span>
<span id="cb83-7"><a href="regression-trees.html#cb83-7"></a>                    <span class="dt">trControl =</span> <span class="kw">trainControl</span>(</span>
<span id="cb83-8"><a href="regression-trees.html#cb83-8"></a>                      <span class="dt">method =</span> <span class="st">&quot;cv&quot;</span>,  <span class="co"># k-fold cross validation</span></span>
<span id="cb83-9"><a href="regression-trees.html#cb83-9"></a>                      <span class="dt">number =</span> <span class="dv">10</span>,  <span class="co"># 10 folds</span></span>
<span id="cb83-10"><a href="regression-trees.html#cb83-10"></a>                      <span class="dt">savePredictions =</span> <span class="st">&quot;final&quot;</span>       <span class="co"># save predictions for the optimal tuning parameter</span></span>
<span id="cb83-11"><a href="regression-trees.html#cb83-11"></a>                      )</span>
<span id="cb83-12"><a href="regression-trees.html#cb83-12"></a>                    )</span>
<span id="cb83-13"><a href="regression-trees.html#cb83-13"></a>carseats.anova3</span></code></pre></div>
<pre><code>## CART 
## 
## 321 samples
##  10 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (10 fold) 
## Summary of sample sizes: 289, 289, 288, 289, 289, 289, ... 
## Resampling results across tuning parameters:
## 
##   cp   RMSE      Rsquared   MAE    
##   0.0  2.153490  0.4843833  1.74153
##   0.1  2.484369  0.2889212  2.03803
##   0.2  2.476571  0.2892989  2.03017
## 
## RMSE was used to select the optimal model using the smallest value.
## The final value used for the model was cp = 0.</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="regression-trees.html#cb85-1"></a><span class="kw">plot</span>(carseats.anova3)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="regression-trees.html#cb86-1"></a>carseats.anova.pred &lt;-<span class="st"> </span><span class="kw">predict</span>(carseats.anova3, carseats.test, <span class="dt">type =</span> <span class="st">&quot;raw&quot;</span>)</span>
<span id="cb86-2"><a href="regression-trees.html#cb86-2"></a><span class="kw">plot</span>(carseats.test<span class="op">$</span>Sales, carseats.anova.pred, </span>
<span id="cb86-3"><a href="regression-trees.html#cb86-3"></a>     <span class="dt">main =</span> <span class="st">&quot;Simple Regression: Predicted vs. Actual&quot;</span>,</span>
<span id="cb86-4"><a href="regression-trees.html#cb86-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Actual&quot;</span>,</span>
<span id="cb86-5"><a href="regression-trees.html#cb86-5"></a>     <span class="dt">ylab =</span> <span class="st">&quot;Predicted&quot;</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-45-2.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="regression-trees.html#cb87-1"></a>(carseats.anova.rmse3 &lt;-<span class="st"> </span><span class="kw">RMSE</span>(<span class="dt">pred =</span> carseats.anova.pred,</span>
<span id="cb87-2"><a href="regression-trees.html#cb87-2"></a>                             <span class="dt">obs =</span> carseats.test<span class="op">$</span>Sales))</span></code></pre></div>
<pre><code>## [1] 1.664759</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="regression-trees.html#cb89-1"></a><span class="kw">rm</span>(carseats.anova.pred)</span>
<span id="cb89-2"><a href="regression-trees.html#cb89-2"></a><span class="kw">rpart.plot</span>(carseats.anova3<span class="op">$</span>finalModel)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-45-3.png" width="672" /></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="regression-trees.html#cb90-1"></a><span class="kw">plot</span>(<span class="kw">varImp</span>(carseats.anova3), <span class="dt">main=</span><span class="st">&quot;Variable Importance with Simple Regression&quot;</span>)</span></code></pre></div>
<p><img src="data-sci_files/figure-html/unnamed-chunk-45-4.png" width="672" /></p>
<p>Looks like the manual effort faired best again. Here is a summary the RMSE values of the three models.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="regression-trees.html#cb91-1"></a><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">model =</span> <span class="st">&quot;Manual ANOVA&quot;</span>, </span>
<span id="cb91-2"><a href="regression-trees.html#cb91-2"></a>                 <span class="dt">RMSE =</span> <span class="kw">round</span>(carseats.anova.rmse, <span class="dv">5</span>)), </span>
<span id="cb91-3"><a href="regression-trees.html#cb91-3"></a>      <span class="kw">data.frame</span>(<span class="dt">model =</span> <span class="st">&quot;Caret w/tuneLength&quot;</span>, </span>
<span id="cb91-4"><a href="regression-trees.html#cb91-4"></a>                 <span class="dt">RMSE =</span> <span class="kw">round</span>(carseats.anova.rmse2, <span class="dv">5</span>)),</span>
<span id="cb91-5"><a href="regression-trees.html#cb91-5"></a>      <span class="kw">data.frame</span>(<span class="dt">model =</span> <span class="st">&quot;Caret w.tuneGrid&quot;</span>, </span>
<span id="cb91-6"><a href="regression-trees.html#cb91-6"></a>                 <span class="dt">RMSE =</span> <span class="kw">round</span>(carseats.anova.rmse3, <span class="dv">5</span>))</span>
<span id="cb91-7"><a href="regression-trees.html#cb91-7"></a>)</span></code></pre></div>
<pre><code>##                model    RMSE
## 1       Manual ANOVA 2.20792
## 2 Caret w/tuneLength 2.20792
## 3   Caret w.tuneGrid 1.66476</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="classification-tree.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bagging.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/lunr.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data-sci.pdf", "data-sci.epub"],
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
