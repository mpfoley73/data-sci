<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Sentiment Analysis | My Data Science Notes</title>
  <meta name="description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Sentiment Analysis | My Data Science Notes" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Sentiment Analysis | My Data Science Notes" />
  
  <meta name="twitter:description" content="This is a compendium of notes from classes, tutorials, etc. that I reference from time to time." />
  

<meta name="author" content="Michael Foley" />


<meta name="date" content="2024-07-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="other-commands.html"/>
<link rel="next" href="text-classification-modeling.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Intro</a></li>
<li class="chapter" data-level="1" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>1</b> Git</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-a-git-repository.html"><a href="getting-a-git-repository.html"><i class="fa fa-check"></i><b>1.1</b> Getting a Git Repository</a></li>
<li class="chapter" data-level="1.2" data-path="branches.html"><a href="branches.html"><i class="fa fa-check"></i><b>1.2</b> Branches</a></li>
<li class="chapter" data-level="1.3" data-path="other-commands.html"><a href="other-commands.html"><i class="fa fa-check"></i><b>1.3</b> Other commands</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html"><i class="fa fa-check"></i><b>2</b> Sentiment Analysis</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="sentiment-analysis.html"><a href="sentiment-analysis.html#n-grams"><i class="fa fa-check"></i><b>2.0.1</b> N-Grams</a></li>
<li class="chapter" data-level="2.1" data-path="text-classification-modeling.html"><a href="text-classification-modeling.html"><i class="fa fa-check"></i><b>2.1</b> Text Classification Modeling</a></li>
<li class="chapter" data-level="2.2" data-path="named-entity-recognition.html"><a href="named-entity-recognition.html"><i class="fa fa-check"></i><b>2.2</b> Named Entity Recognition</a></li>
<li class="chapter" data-level="2.3" data-path="appendix-tm.html"><a href="appendix-tm.html"><i class="fa fa-check"></i><b>2.3</b> Appendix: tm</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">My Data Science Notes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sentiment-analysis" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Sentiment Analysis<a href="sentiment-analysis.html#sentiment-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Create a topic model with <code>stm::stm()</code>. Parameter <code>K</code> specifies the number of topics. Here are models with 5 - 50 topics. This process can take a while, but the <strong>furrr</strong> package and <code>future_map()</code> function leverage parallel processing to make it quicker.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="sentiment-analysis.html#cb15-1" tabindex="-1"></a>heldout <span class="ot">&lt;-</span> <span class="fu">make.heldout</span>(sawyer_dfm)</span>
<span id="cb15-2"><a href="sentiment-analysis.html#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="sentiment-analysis.html#cb15-3" tabindex="-1"></a>k_result <span class="ot">&lt;-</span> sawyer_stm_mdls <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="sentiment-analysis.html#cb15-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exclusivity        =</span> <span class="fu">map</span>(mdl, exclusivity),</span>
<span id="cb15-5"><a href="sentiment-analysis.html#cb15-5" tabindex="-1"></a>         <span class="at">semantic_coherence =</span> <span class="fu">map</span>(mdl, semanticCoherence, sawyer_dfm),</span>
<span id="cb15-6"><a href="sentiment-analysis.html#cb15-6" tabindex="-1"></a>         <span class="at">eval_heldout       =</span> <span class="fu">map</span>(mdl, eval.heldout, heldout<span class="sc">$</span>missing),</span>
<span id="cb15-7"><a href="sentiment-analysis.html#cb15-7" tabindex="-1"></a>         <span class="at">residual           =</span> <span class="fu">map</span>(mdl, checkResiduals, sawyer_dfm),</span>
<span id="cb15-8"><a href="sentiment-analysis.html#cb15-8" tabindex="-1"></a>         <span class="at">bound              =</span> <span class="fu">map_dbl</span>(mdl, <span class="sc">~</span><span class="fu">max</span>(.<span class="sc">$</span>convergence<span class="sc">$</span>bound)),</span>
<span id="cb15-9"><a href="sentiment-analysis.html#cb15-9" tabindex="-1"></a>         <span class="at">lfact              =</span> <span class="fu">map_dbl</span>(mdl, <span class="sc">~</span><span class="fu">lfactorial</span>(.<span class="sc">$</span>settings<span class="sc">$</span>dim<span class="sc">$</span>K)),</span>
<span id="cb15-10"><a href="sentiment-analysis.html#cb15-10" tabindex="-1"></a>         <span class="at">lbound             =</span> bound <span class="sc">+</span> lfact,</span>
<span id="cb15-11"><a href="sentiment-analysis.html#cb15-11" tabindex="-1"></a>         <span class="at">iterations         =</span> <span class="fu">map_dbl</span>(mdl, <span class="sc">~</span><span class="fu">length</span>(.<span class="sc">$</span>convergence<span class="sc">$</span>bound)))</span>
<span id="cb15-12"><a href="sentiment-analysis.html#cb15-12" tabindex="-1"></a></span>
<span id="cb15-13"><a href="sentiment-analysis.html#cb15-13" tabindex="-1"></a>k_result <span class="sc">%&gt;%</span></span>
<span id="cb15-14"><a href="sentiment-analysis.html#cb15-14" tabindex="-1"></a>  <span class="fu">transmute</span>(K,</span>
<span id="cb15-15"><a href="sentiment-analysis.html#cb15-15" tabindex="-1"></a>            <span class="st">`</span><span class="at">Lower bound</span><span class="st">`</span> <span class="ot">=</span> lbound,</span>
<span id="cb15-16"><a href="sentiment-analysis.html#cb15-16" tabindex="-1"></a>            <span class="at">Residuals =</span> <span class="fu">map_dbl</span>(residual, <span class="st">&quot;dispersion&quot;</span>),</span>
<span id="cb15-17"><a href="sentiment-analysis.html#cb15-17" tabindex="-1"></a>            <span class="st">`</span><span class="at">Semantic coherence</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(semantic_coherence, mean),</span>
<span id="cb15-18"><a href="sentiment-analysis.html#cb15-18" tabindex="-1"></a>            <span class="st">`</span><span class="at">Held-out likelihood</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">map_dbl</span>(eval_heldout, <span class="st">&quot;expected.heldout&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a href="sentiment-analysis.html#cb15-19" tabindex="-1"></a>  <span class="fu">gather</span>(Metric, Value, <span class="sc">-</span>K) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="sentiment-analysis.html#cb15-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(K, Value, <span class="at">color =</span> Metric)) <span class="sc">+</span></span>
<span id="cb15-21"><a href="sentiment-analysis.html#cb15-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="sentiment-analysis.html#cb15-22" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Metric, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-23"><a href="sentiment-analysis.html#cb15-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;K (number of topics)&quot;</span>,</span>
<span id="cb15-24"><a href="sentiment-analysis.html#cb15-24" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb15-25"><a href="sentiment-analysis.html#cb15-25" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Model diagnostics by number of topics&quot;</span>,</span>
<span id="cb15-26"><a href="sentiment-analysis.html#cb15-26" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;These diagnostics indicate that a good number of topics would be around 60&quot;</span>)</span></code></pre></div>
<p>The held-out likelihood is highest between 30 and 50, and the residuals are lowest at 20, so 30 might be the right number. Semantic coherence is maximized when the most probable words in a given topic frequently co-occur together. Coherence tends to fall as exclusivity increases. You’ll want the topic size that balances the trade-off.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="sentiment-analysis.html#cb16-1" tabindex="-1"></a>k_result <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="sentiment-analysis.html#cb16-2" tabindex="-1"></a>  <span class="fu">select</span>(K, exclusivity, semantic_coherence) <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="sentiment-analysis.html#cb16-3" tabindex="-1"></a>  <span class="fu">filter</span>(K <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="sentiment-analysis.html#cb16-4" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(exclusivity, semantic_coherence)) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="sentiment-analysis.html#cb16-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K =</span> <span class="fu">as.factor</span>(K)) <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="sentiment-analysis.html#cb16-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(semantic_coherence, exclusivity, <span class="at">color =</span> K)) <span class="sc">+</span></span>
<span id="cb16-7"><a href="sentiment-analysis.html#cb16-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="sentiment-analysis.html#cb16-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Semantic coherence&quot;</span>,</span>
<span id="cb16-9"><a href="sentiment-analysis.html#cb16-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Exclusivity&quot;</span>,</span>
<span id="cb16-10"><a href="sentiment-analysis.html#cb16-10" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Comparing exclusivity and semantic coherence&quot;</span>,</span>
<span id="cb16-11"><a href="sentiment-analysis.html#cb16-11" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Models with fewer topics have higher semantic coherence for more topics, but lower exclusivity&quot;</span>)</span></code></pre></div>
<p>It looks like <em>k</em> = 30 may be optimal.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="sentiment-analysis.html#cb17-1" tabindex="-1"></a>sawyer_stm <span class="ot">&lt;-</span> sawyer_stm_mdls <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="sentiment-analysis.html#cb17-2" tabindex="-1"></a>  <span class="fu">filter</span>(K <span class="sc">==</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="sentiment-analysis.html#cb17-3" tabindex="-1"></a>  <span class="fu">pull</span>(mdl) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="sentiment-analysis.html#cb17-4" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Like <code>LDA()</code>, <code>stm()</code> returns two outputs: a “beta” matrix of probabilities of terms belonging to topics; a “gamma” matrix of probabilities of topics contributing to documents. The tidytext package provides a <code>tidy()</code> method for extracting these matrices.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="sentiment-analysis.html#cb18-1" tabindex="-1"></a>sawyer_stm_beta <span class="ot">&lt;-</span> <span class="fu">tidy</span>(sawyer_stm, <span class="at">matrix =</span> <span class="st">&quot;beta&quot;</span>) </span>
<span id="cb18-2"><a href="sentiment-analysis.html#cb18-2" tabindex="-1"></a>sawyer_stm_gamma <span class="ot">&lt;-</span> <span class="fu">tidy</span>(sawyer_stm, <span class="at">matrix =</span> <span class="st">&quot;gamma&quot;</span>, <span class="at">document_names =</span> <span class="fu">rownames</span>(sawyer_dfm)) </span></code></pre></div>
<p>I have 30 topics here, so it would be hard to show the top words per topic, but here are the first six topics.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="sentiment-analysis.html#cb19-1" tabindex="-1"></a>sawyer_stm_beta <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="sentiment-analysis.html#cb19-2" tabindex="-1"></a>  <span class="fu">filter</span>(topic <span class="sc">&lt;=</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="sentiment-analysis.html#cb19-3" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="sentiment-analysis.html#cb19-4" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> beta, <span class="at">n =</span> <span class="dv">10</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="sentiment-analysis.html#cb19-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">reorder_within</span>(term, beta, topic)) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="sentiment-analysis.html#cb19-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> beta, <span class="at">fill =</span> <span class="fu">factor</span>(topic))) <span class="sc">+</span></span>
<span id="cb19-7"><a href="sentiment-analysis.html#cb19-7" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb19-8"><a href="sentiment-analysis.html#cb19-8" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">name =</span> <span class="st">&quot;Set2&quot;</span>), <span class="at">name =</span> <span class="st">&quot;Topic&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-9"><a href="sentiment-analysis.html#cb19-9" tabindex="-1"></a>  <span class="fu">scale_x_reordered</span>() <span class="sc">+</span></span>
<span id="cb19-10"><a href="sentiment-analysis.html#cb19-10" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb19-11"><a href="sentiment-analysis.html#cb19-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> topic, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-12"><a href="sentiment-analysis.html#cb19-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;STM Beta Matrix for first six topics&quot;</span>,</span>
<span id="cb19-13"><a href="sentiment-analysis.html#cb19-13" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Showing top 10 word probabilities&quot;</span>)</span></code></pre></div>
<p>Here is a Word cloud representation.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="sentiment-analysis.html#cb20-1" tabindex="-1"></a>colors6 <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n =</span> <span class="dv">6</span>, <span class="at">name =</span> <span class="st">&quot;Set2&quot;</span>)</span>
<span id="cb20-2"><a href="sentiment-analysis.html#cb20-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="sc">~</span> <span class="fu">with</span>(sawyer_stm_beta <span class="sc">%&gt;%</span> <span class="fu">filter</span>(topic <span class="sc">==</span> .x), </span>
<span id="cb20-3"><a href="sentiment-analysis.html#cb20-3" tabindex="-1"></a>                        wordcloud<span class="sc">::</span><span class="fu">wordcloud</span>(term, beta, <span class="at">max.words =</span> <span class="dv">20</span>,</span>
<span id="cb20-4"><a href="sentiment-analysis.html#cb20-4" tabindex="-1"></a>                                             <span class="at">colors =</span> colors6[.x])))</span></code></pre></div>
<p>And here are the most prevalent topics across chapters.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="sentiment-analysis.html#cb21-1" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> sawyer_stm_beta <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="sentiment-analysis.html#cb21-2" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="sentiment-analysis.html#cb21-3" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> beta, <span class="at">n =</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="sentiment-analysis.html#cb21-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>, <span class="at">terms =</span> <span class="fu">list</span>(term)) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="sentiment-analysis.html#cb21-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">terms =</span> <span class="fu">map</span>(terms, paste, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="sentiment-analysis.html#cb21-6" tabindex="-1"></a>  <span class="fu">unnest</span>(terms)</span>
<span id="cb21-7"><a href="sentiment-analysis.html#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="sentiment-analysis.html#cb21-8" tabindex="-1"></a>sawyer_stm_gamma <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="sentiment-analysis.html#cb21-9" tabindex="-1"></a>  <span class="fu">group_by</span>(topic) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="sentiment-analysis.html#cb21-10" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>, <span class="at">gamma =</span> <span class="fu">mean</span>(gamma)) <span class="sc">%&gt;%</span></span>
<span id="cb21-11"><a href="sentiment-analysis.html#cb21-11" tabindex="-1"></a>  <span class="fu">left_join</span>(top_terms, <span class="at">by =</span> <span class="st">&quot;topic&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-12"><a href="sentiment-analysis.html#cb21-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">topic =</span> <span class="fu">paste</span>(<span class="st">&quot;topic&quot;</span>, topic),</span>
<span id="cb21-13"><a href="sentiment-analysis.html#cb21-13" tabindex="-1"></a>         <span class="at">topic =</span> <span class="fu">fct_reorder</span>(topic, gamma)) <span class="sc">%&gt;%</span></span>
<span id="cb21-14"><a href="sentiment-analysis.html#cb21-14" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> gamma, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-15"><a href="sentiment-analysis.html#cb21-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> topic, <span class="at">y =</span> gamma, <span class="at">label =</span> terms)) <span class="sc">+</span></span>
<span id="cb21-16"><a href="sentiment-analysis.html#cb21-16" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;#D8A7B1&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-17"><a href="sentiment-analysis.html#cb21-17" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">nudge_y =</span> <span class="fl">0.0005</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb21-18"><a href="sentiment-analysis.html#cb21-18" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb21-19"><a href="sentiment-analysis.html#cb21-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb21-20"><a href="sentiment-analysis.html#cb21-20" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.09</span>),</span>
<span id="cb21-21"><a href="sentiment-analysis.html#cb21-21" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb21-22"><a href="sentiment-analysis.html#cb21-22" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-23"><a href="sentiment-analysis.html#cb21-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb21-24"><a href="sentiment-analysis.html#cb21-24" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="fu">expression</span>(gamma),</span>
<span id="cb21-25"><a href="sentiment-analysis.html#cb21-25" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Top 10 STM topics by prevalence in The Adentures of Tom Sawyer&quot;</span>,</span>
<span id="cb21-26"><a href="sentiment-analysis.html#cb21-26" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;With top words in each topic&quot;</span>)</span></code></pre></div>
<p>Another way to look at the betas is to identify terms that had the greatest difference in beta between the first and second most probable topic. A good way to do this is with their log ratio, <span class="math inline">\(log_2(\beta_2 / \beta_1)\)</span>. Filter for relatively common words having a beta greater than 1/100 in at least one topic.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="sentiment-analysis.html#cb22-1" tabindex="-1"></a>sawyer_stm_beta <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="sentiment-analysis.html#cb22-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">topic =</span> <span class="fu">paste0</span>(<span class="st">&quot;topic&quot;</span>, topic)) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="sentiment-analysis.html#cb22-3" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="sentiment-analysis.html#cb22-4" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> beta, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="sentiment-analysis.html#cb22-5" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>, <span class="at">min_beta =</span> <span class="fu">min</span>(beta)<span class="sc">+</span>.<span class="dv">001</span>, <span class="at">max_beta =</span> <span class="fu">max</span>(beta)<span class="sc">+</span>.<span class="dv">001</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="sentiment-analysis.html#cb22-6" tabindex="-1"></a>  <span class="fu">filter</span>(max_beta <span class="sc">&gt;</span> <span class="fl">0.01</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="sentiment-analysis.html#cb22-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_ratio =</span> <span class="fu">log2</span>(max_beta <span class="sc">/</span> min_beta)) <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="sentiment-analysis.html#cb22-8" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="at">n =</span> <span class="dv">20</span>, <span class="at">w =</span> <span class="fu">abs</span>(log_ratio)) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="sentiment-analysis.html#cb22-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>log_ratio) <span class="sc">%&gt;%</span></span>
<span id="cb22-10"><a href="sentiment-analysis.html#cb22-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_rev</span>(<span class="fu">fct_inorder</span>(term)), <span class="at">y =</span> log_ratio)) <span class="sc">+</span></span>
<span id="cb22-11"><a href="sentiment-analysis.html#cb22-11" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;#D8A7B1&quot;</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="sentiment-analysis.html#cb22-12" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-13"><a href="sentiment-analysis.html#cb22-13" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb22-14"><a href="sentiment-analysis.html#cb22-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;STM beta matrix log ratios&quot;</span>,</span>
<span id="cb22-15"><a href="sentiment-analysis.html#cb22-15" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;showing greatest differences in beta values&quot;</span>,</span>
<span id="cb22-16"><a href="sentiment-analysis.html#cb22-16" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;log(beta ratio)&quot;</span>)</span></code></pre></div>
<p>A typical sentiment analysis involves unnesting tokens with <code>unnest_tokens()</code>, assigning sentiments with <code>inner_join(sentiments)</code>, counting tokens with <code>count()</code>, and summarizing and visualizing.</p>
<p>The tidytext package contains four sentiment lexicons, all based on unigrams.</p>
<ul>
<li><strong>nrc</strong>. binary “yes”/“no” for categories positive, negative, anger, anticipation, disgust, fear, joy, sadness, surprise, and trust.</li>
<li><strong>bing</strong>. “positive”/“negative” classification.</li>
<li><strong>AFINN</strong>. score between -5 (most negative) and 5 (most positive).</li>
<li><strong>loughran</strong>. “positive”/“negative”/“litigious”/“uncertainty”/“constraining”/“superflous” classification.</li>
</ul>
<p>You can view the sentiment assignments with <code>get_sentiments(lexicon = c("afinn", "bing", nrc", "laughlin"))</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="sentiment-analysis.html#cb23-1" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="at">lexicon =</span> <span class="st">&quot;nrc&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="sentiment-analysis.html#cb23-2" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="sentiment-analysis.html#cb23-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">&quot;nrc&quot;</span>)</span>
<span id="cb23-4"><a href="sentiment-analysis.html#cb23-4" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="at">lexicon =</span> <span class="st">&quot;bing&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="sentiment-analysis.html#cb23-5" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="sentiment-analysis.html#cb23-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">&quot;bing&quot;</span>)</span>
<span id="cb23-7"><a href="sentiment-analysis.html#cb23-7" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="at">lexicon =</span> <span class="st">&quot;afinn&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-8"><a href="sentiment-analysis.html#cb23-8" tabindex="-1"></a>  <span class="fu">count</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="sentiment-analysis.html#cb23-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">&quot;afinn&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="sentiment-analysis.html#cb23-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">as.character</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="sentiment-analysis.html#cb23-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>value)</span>
<span id="cb23-12"><a href="sentiment-analysis.html#cb23-12" tabindex="-1"></a>x4 <span class="ot">&lt;-</span> <span class="fu">get_sentiments</span>(<span class="at">lexicon =</span> <span class="st">&quot;loughran&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-13"><a href="sentiment-analysis.html#cb23-13" tabindex="-1"></a>  <span class="fu">count</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb23-14"><a href="sentiment-analysis.html#cb23-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lexicon =</span> <span class="st">&quot;loughran&quot;</span>)</span>
<span id="cb23-15"><a href="sentiment-analysis.html#cb23-15" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(x1, x2, x3, x4)</span>
<span id="cb23-16"><a href="sentiment-analysis.html#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="sentiment-analysis.html#cb23-17" tabindex="-1"></a><span class="fu">ggplot</span>(x, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fct_reorder</span>(sentiment, n), <span class="at">y =</span> n, <span class="at">fill =</span> lexicon)) <span class="sc">+</span></span>
<span id="cb23-18"><a href="sentiment-analysis.html#cb23-18" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb23-19"><a href="sentiment-analysis.html#cb23-19" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb23-20"><a href="sentiment-analysis.html#cb23-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sentiment Counts&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb23-21"><a href="sentiment-analysis.html#cb23-21" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> lexicon, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p>Here is a sentiment analysis of sections of 80 lines of Jane Austin’s books. <em>(Small sections may not have enough words to get a good estimate of sentiment, and large sections can wash out the narrative structure. 80 lines seems about right.)</em></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="sentiment-analysis.html#cb24-1" tabindex="-1"></a><span class="co"># austin_tidy %&gt;%</span></span>
<span id="cb24-2"><a href="sentiment-analysis.html#cb24-2" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;bing&quot;)) %&gt;%</span></span>
<span id="cb24-3"><a href="sentiment-analysis.html#cb24-3" tabindex="-1"></a><span class="co">#   count(book, index = linenumber %/% 80, sentiment) %&gt;%</span></span>
<span id="cb24-4"><a href="sentiment-analysis.html#cb24-4" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = sentiment, values_from = n, values_fill = list(n = 0)) %&gt;%</span></span>
<span id="cb24-5"><a href="sentiment-analysis.html#cb24-5" tabindex="-1"></a><span class="co">#   mutate(sentiment = positive - negative) %&gt;%</span></span>
<span id="cb24-6"><a href="sentiment-analysis.html#cb24-6" tabindex="-1"></a><span class="co">#   ggplot(aes(x = index, y = sentiment, fill = book)) +</span></span>
<span id="cb24-7"><a href="sentiment-analysis.html#cb24-7" tabindex="-1"></a><span class="co">#   geom_col(show.legend = FALSE) +</span></span>
<span id="cb24-8"><a href="sentiment-analysis.html#cb24-8" tabindex="-1"></a><span class="co">#   facet_wrap(~book, ncol = 2, scales = &quot;free_x&quot;)</span></span></code></pre></div>
<p>Fair to say Jane Austin novels tend to have a happy ending? The three sentiment lexicons provide different views of THE data. Here is a comparison of the lexicons using one of Jane Austin’s novels, “Pride and Prejudice”.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="sentiment-analysis.html#cb25-1" tabindex="-1"></a><span class="co"># # AFINN lexicon measures sentiment with a numeric score between -5 and 5.</span></span>
<span id="cb25-2"><a href="sentiment-analysis.html#cb25-2" tabindex="-1"></a><span class="co"># afinn &lt;- austin_tidy %&gt;% </span></span>
<span id="cb25-3"><a href="sentiment-analysis.html#cb25-3" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb25-4"><a href="sentiment-analysis.html#cb25-4" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;afinn&quot;), by = &quot;word&quot;) %&gt;% </span></span>
<span id="cb25-5"><a href="sentiment-analysis.html#cb25-5" tabindex="-1"></a><span class="co">#   group_by(index = linenumber %/% 80) %&gt;% </span></span>
<span id="cb25-6"><a href="sentiment-analysis.html#cb25-6" tabindex="-1"></a><span class="co">#   summarise(sentiment = sum(value)) %&gt;% </span></span>
<span id="cb25-7"><a href="sentiment-analysis.html#cb25-7" tabindex="-1"></a><span class="co">#   mutate(method = &quot;AFINN&quot;)</span></span>
<span id="cb25-8"><a href="sentiment-analysis.html#cb25-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-9"><a href="sentiment-analysis.html#cb25-9" tabindex="-1"></a><span class="co"># # Bing and nrc categorize words in a binary fashion, either positive or negative.</span></span>
<span id="cb25-10"><a href="sentiment-analysis.html#cb25-10" tabindex="-1"></a><span class="co"># bing &lt;- austin_tidy %&gt;%</span></span>
<span id="cb25-11"><a href="sentiment-analysis.html#cb25-11" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb25-12"><a href="sentiment-analysis.html#cb25-12" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;bing&quot;), by = &quot;word&quot;) %&gt;% </span></span>
<span id="cb25-13"><a href="sentiment-analysis.html#cb25-13" tabindex="-1"></a><span class="co">#   count(index = linenumber %/% 80, sentiment) %&gt;%</span></span>
<span id="cb25-14"><a href="sentiment-analysis.html#cb25-14" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = sentiment, values_from =  n, values_fill = list(n = 0)) %&gt;%</span></span>
<span id="cb25-15"><a href="sentiment-analysis.html#cb25-15" tabindex="-1"></a><span class="co">#   mutate(sentiment = positive - negative) %&gt;% </span></span>
<span id="cb25-16"><a href="sentiment-analysis.html#cb25-16" tabindex="-1"></a><span class="co">#   mutate(method = &quot;Bing&quot;) %&gt;%</span></span>
<span id="cb25-17"><a href="sentiment-analysis.html#cb25-17" tabindex="-1"></a><span class="co">#   select(index, sentiment, method)</span></span>
<span id="cb25-18"><a href="sentiment-analysis.html#cb25-18" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-19"><a href="sentiment-analysis.html#cb25-19" tabindex="-1"></a><span class="co"># nrc &lt;- austin_tidy %&gt;%</span></span>
<span id="cb25-20"><a href="sentiment-analysis.html#cb25-20" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb25-21"><a href="sentiment-analysis.html#cb25-21" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;nrc&quot;) %&gt;% filter(sentiment %in% c(&quot;positive&quot;, &quot;negative&quot;)), by = &quot;word&quot;) %&gt;% </span></span>
<span id="cb25-22"><a href="sentiment-analysis.html#cb25-22" tabindex="-1"></a><span class="co">#   count(index = linenumber %/% 80, sentiment) %&gt;%</span></span>
<span id="cb25-23"><a href="sentiment-analysis.html#cb25-23" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = sentiment, values_from = n, values_fill = list(n = 0)) %&gt;%</span></span>
<span id="cb25-24"><a href="sentiment-analysis.html#cb25-24" tabindex="-1"></a><span class="co">#   mutate(sentiment = positive - negative) %&gt;% </span></span>
<span id="cb25-25"><a href="sentiment-analysis.html#cb25-25" tabindex="-1"></a><span class="co">#   mutate(method = &quot;NRC&quot;) %&gt;%</span></span>
<span id="cb25-26"><a href="sentiment-analysis.html#cb25-26" tabindex="-1"></a><span class="co">#   select(index, sentiment, method)</span></span>
<span id="cb25-27"><a href="sentiment-analysis.html#cb25-27" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb25-28"><a href="sentiment-analysis.html#cb25-28" tabindex="-1"></a><span class="co"># bind_rows(afinn, bing, nrc) %&gt;%</span></span>
<span id="cb25-29"><a href="sentiment-analysis.html#cb25-29" tabindex="-1"></a><span class="co">#   ggplot(aes(index, sentiment, fill = method)) +</span></span>
<span id="cb25-30"><a href="sentiment-analysis.html#cb25-30" tabindex="-1"></a><span class="co">#   geom_col(show.legend = FALSE) +</span></span>
<span id="cb25-31"><a href="sentiment-analysis.html#cb25-31" tabindex="-1"></a><span class="co">#   facet_wrap(~method, ncol = 1, scales = &quot;free_y&quot;)</span></span></code></pre></div>
<p>In this example, and in general, <strong>NRC</strong> sentiment tends to be high, <strong>AFINN</strong> sentiment has more variance, and <strong>Bing</strong> sentiment finds longer stretches of similar text. However, all three agree roughly on the overall trends in the sentiment through a narrative arc.</p>
<p>What are the top-10 positive and negative words? Using the Bing lexicon, get the counts, then <code>group_by(sentiment)</code> and <code>top_n()</code> to the top 10 in each category.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="sentiment-analysis.html#cb26-1" tabindex="-1"></a><span class="co"># austin_tidy %&gt;%</span></span>
<span id="cb26-2"><a href="sentiment-analysis.html#cb26-2" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb26-3"><a href="sentiment-analysis.html#cb26-3" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;bing&quot;), by = &quot;word&quot;) %&gt;% </span></span>
<span id="cb26-4"><a href="sentiment-analysis.html#cb26-4" tabindex="-1"></a><span class="co">#   count(word, sentiment, sort = TRUE) %&gt;%</span></span>
<span id="cb26-5"><a href="sentiment-analysis.html#cb26-5" tabindex="-1"></a><span class="co">#   group_by(sentiment) %&gt;%</span></span>
<span id="cb26-6"><a href="sentiment-analysis.html#cb26-6" tabindex="-1"></a><span class="co">#   top_n(n = 10, wt = n) %&gt;%</span></span>
<span id="cb26-7"><a href="sentiment-analysis.html#cb26-7" tabindex="-1"></a><span class="co">#   ggplot(aes(x = fct_reorder(word, n), y = n, fill = sentiment)) +</span></span>
<span id="cb26-8"><a href="sentiment-analysis.html#cb26-8" tabindex="-1"></a><span class="co">#   geom_col(show.legend = FALSE) +</span></span>
<span id="cb26-9"><a href="sentiment-analysis.html#cb26-9" tabindex="-1"></a><span class="co">#   facet_wrap(~sentiment, scales = &quot;free_y&quot;) +</span></span>
<span id="cb26-10"><a href="sentiment-analysis.html#cb26-10" tabindex="-1"></a><span class="co">#   coord_flip() +</span></span>
<span id="cb26-11"><a href="sentiment-analysis.html#cb26-11" tabindex="-1"></a><span class="co">#   labs(y = &quot;Contribution to Sentiment&quot;,</span></span>
<span id="cb26-12"><a href="sentiment-analysis.html#cb26-12" tabindex="-1"></a><span class="co">#        x = &quot;&quot;)</span></span></code></pre></div>
<p>Uh oh, “miss” is a red-herring - in Jane Austin novels it often refers to an unmarried woman. Drop it from the analysis by appending it to the stop-words list.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="sentiment-analysis.html#cb27-1" tabindex="-1"></a><span class="co"># austin_tidy %&gt;%</span></span>
<span id="cb27-2"><a href="sentiment-analysis.html#cb27-2" tabindex="-1"></a><span class="co">#   anti_join(bind_rows(stop_words,</span></span>
<span id="cb27-3"><a href="sentiment-analysis.html#cb27-3" tabindex="-1"></a><span class="co">#                       tibble(word = c(&quot;miss&quot;), lexicon = c(&quot;custom&quot;)))) %&gt;%</span></span>
<span id="cb27-4"><a href="sentiment-analysis.html#cb27-4" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb27-5"><a href="sentiment-analysis.html#cb27-5" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;bing&quot;)) %&gt;% </span></span>
<span id="cb27-6"><a href="sentiment-analysis.html#cb27-6" tabindex="-1"></a><span class="co">#   count(word, sentiment, sort = TRUE) %&gt;%</span></span>
<span id="cb27-7"><a href="sentiment-analysis.html#cb27-7" tabindex="-1"></a><span class="co">#   group_by(sentiment) %&gt;%</span></span>
<span id="cb27-8"><a href="sentiment-analysis.html#cb27-8" tabindex="-1"></a><span class="co">#   top_n(n = 10, wt = n) %&gt;%</span></span>
<span id="cb27-9"><a href="sentiment-analysis.html#cb27-9" tabindex="-1"></a><span class="co">#   ggplot(aes(x = fct_reorder(word, n), y = n, fill = sentiment)) +</span></span>
<span id="cb27-10"><a href="sentiment-analysis.html#cb27-10" tabindex="-1"></a><span class="co">#   geom_col(show.legend = FALSE) +</span></span>
<span id="cb27-11"><a href="sentiment-analysis.html#cb27-11" tabindex="-1"></a><span class="co">#   facet_wrap(~sentiment, scales = &quot;free_y&quot;) +</span></span>
<span id="cb27-12"><a href="sentiment-analysis.html#cb27-12" tabindex="-1"></a><span class="co">#   coord_flip() +</span></span>
<span id="cb27-13"><a href="sentiment-analysis.html#cb27-13" tabindex="-1"></a><span class="co">#   labs(y = &quot;Contribution to Sentiment&quot;,</span></span>
<span id="cb27-14"><a href="sentiment-analysis.html#cb27-14" tabindex="-1"></a><span class="co">#        x = &quot;&quot;)</span></span></code></pre></div>
<p>Better!</p>
<p>A common way to visualize sentiments is with a word cloud.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="sentiment-analysis.html#cb28-1" tabindex="-1"></a><span class="co"># austin_tidy %&gt;%</span></span>
<span id="cb28-2"><a href="sentiment-analysis.html#cb28-2" tabindex="-1"></a><span class="co">#   anti_join(bind_rows(stop_words,</span></span>
<span id="cb28-3"><a href="sentiment-analysis.html#cb28-3" tabindex="-1"></a><span class="co">#                       tibble(word = c(&quot;miss&quot;), lexicon = c(&quot;custom&quot;)))) %&gt;%</span></span>
<span id="cb28-4"><a href="sentiment-analysis.html#cb28-4" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb28-5"><a href="sentiment-analysis.html#cb28-5" tabindex="-1"></a><span class="co">#   count(word) %&gt;%</span></span>
<span id="cb28-6"><a href="sentiment-analysis.html#cb28-6" tabindex="-1"></a><span class="co">#   with(wordcloud(word, n, max.words = 100))</span></span></code></pre></div>
<p><code>comparison.cloud</code> is another implementation of a word cloud. It takes a matrix input.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="sentiment-analysis.html#cb29-1" tabindex="-1"></a><span class="co"># x &lt;- austin_tidy %&gt;%</span></span>
<span id="cb29-2"><a href="sentiment-analysis.html#cb29-2" tabindex="-1"></a><span class="co">#   anti_join(bind_rows(stop_words,</span></span>
<span id="cb29-3"><a href="sentiment-analysis.html#cb29-3" tabindex="-1"></a><span class="co">#                       tibble(word = c(&quot;miss&quot;), lexicon = c(&quot;custom&quot;)))) %&gt;%</span></span>
<span id="cb29-4"><a href="sentiment-analysis.html#cb29-4" tabindex="-1"></a><span class="co">#   inner_join(get_sentiments(&quot;bing&quot;)) %&gt;% </span></span>
<span id="cb29-5"><a href="sentiment-analysis.html#cb29-5" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb29-6"><a href="sentiment-analysis.html#cb29-6" tabindex="-1"></a><span class="co">#   count(word, sentiment, sort = TRUE) %&gt;%</span></span>
<span id="cb29-7"><a href="sentiment-analysis.html#cb29-7" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = sentiment, values_from = n, values_fill = list(n = 0)) %&gt;%</span></span>
<span id="cb29-8"><a href="sentiment-analysis.html#cb29-8" tabindex="-1"></a><span class="co">#   as.data.frame()</span></span>
<span id="cb29-9"><a href="sentiment-analysis.html#cb29-9" tabindex="-1"></a><span class="co"># rownames(x) &lt;- x[,1]</span></span>
<span id="cb29-10"><a href="sentiment-analysis.html#cb29-10" tabindex="-1"></a><span class="co"># comparison.cloud(x[, 2:3])</span></span>
<span id="cb29-11"><a href="sentiment-analysis.html#cb29-11" tabindex="-1"></a><span class="co"># rm(x)</span></span></code></pre></div>
<p>Sometimes it makes more sense to analyze entire sentences. Specify <code>unnest_tokens(..., token = "sentences")</code> to override the default <code>token = "word"</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="sentiment-analysis.html#cb30-1" tabindex="-1"></a><span class="co"># austen_books() %&gt;%</span></span>
<span id="cb30-2"><a href="sentiment-analysis.html#cb30-2" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;%</span></span>
<span id="cb30-3"><a href="sentiment-analysis.html#cb30-3" tabindex="-1"></a><span class="co">#   mutate(linenumber = row_number(),</span></span>
<span id="cb30-4"><a href="sentiment-analysis.html#cb30-4" tabindex="-1"></a><span class="co">#          chapter = cumsum(str_detect(text, regex(&quot;^chapter [\\divxlc]&quot;,</span></span>
<span id="cb30-5"><a href="sentiment-analysis.html#cb30-5" tabindex="-1"></a><span class="co">#                                                  ignore_case = TRUE)))) %&gt;%</span></span>
<span id="cb30-6"><a href="sentiment-analysis.html#cb30-6" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb30-7"><a href="sentiment-analysis.html#cb30-7" tabindex="-1"></a><span class="co">#   unnest_tokens(output = word, input = text, token = &quot;sentences&quot;)</span></span></code></pre></div>
<div id="n-grams" class="section level3 hasAnchor" number="2.0.1">
<h3><span class="header-section-number">2.0.1</span> N-Grams<a href="sentiment-analysis.html#n-grams" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Create n-grams by specifying <code>unnest_tokens(..., token = "ngrams", n)</code> where <code>n = 2</code> is a bigram, etc. To remove the stop words, <code>separate</code> the n-grams, then filter on the <code>stop_words</code> data set.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="sentiment-analysis.html#cb31-1" tabindex="-1"></a><span class="co"># austin.2gram &lt;- austen_books() %&gt;%</span></span>
<span id="cb31-2"><a href="sentiment-analysis.html#cb31-2" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;%</span></span>
<span id="cb31-3"><a href="sentiment-analysis.html#cb31-3" tabindex="-1"></a><span class="co">#   mutate(linenumber = row_number(),</span></span>
<span id="cb31-4"><a href="sentiment-analysis.html#cb31-4" tabindex="-1"></a><span class="co">#          chapter = cumsum(str_detect(text, regex(&quot;^chapter [\\divxlc]&quot;,</span></span>
<span id="cb31-5"><a href="sentiment-analysis.html#cb31-5" tabindex="-1"></a><span class="co">#                                                  ignore_case = TRUE)))) %&gt;%</span></span>
<span id="cb31-6"><a href="sentiment-analysis.html#cb31-6" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb31-7"><a href="sentiment-analysis.html#cb31-7" tabindex="-1"></a><span class="co">#   unnest_tokens(output = bigram, input = text, token = &quot;ngrams&quot;, n = 2)</span></span>
<span id="cb31-8"><a href="sentiment-analysis.html#cb31-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-9"><a href="sentiment-analysis.html#cb31-9" tabindex="-1"></a><span class="co"># austin.2gram &lt;- austin.2gram %&gt;%</span></span>
<span id="cb31-10"><a href="sentiment-analysis.html#cb31-10" tabindex="-1"></a><span class="co">#   separate(bigram, c(&quot;word1&quot;, &quot;word2&quot;), sep = &quot; &quot;) %&gt;%</span></span>
<span id="cb31-11"><a href="sentiment-analysis.html#cb31-11" tabindex="-1"></a><span class="co">#   filter(!word1 %in% stop_words$word &amp;</span></span>
<span id="cb31-12"><a href="sentiment-analysis.html#cb31-12" tabindex="-1"></a><span class="co">#            !word2 %in% stop_words$word &amp;</span></span>
<span id="cb31-13"><a href="sentiment-analysis.html#cb31-13" tabindex="-1"></a><span class="co">#            !is.na(word1) &amp; !is.na(word2)) %&gt;%</span></span>
<span id="cb31-14"><a href="sentiment-analysis.html#cb31-14" tabindex="-1"></a><span class="co">#   unite(bigram, word1, word2, sep = &quot; &quot;)</span></span>
<span id="cb31-15"><a href="sentiment-analysis.html#cb31-15" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb31-16"><a href="sentiment-analysis.html#cb31-16" tabindex="-1"></a><span class="co"># austin.2gram %&gt;%</span></span>
<span id="cb31-17"><a href="sentiment-analysis.html#cb31-17" tabindex="-1"></a><span class="co">#   count(book, bigram, sort = TRUE)</span></span></code></pre></div>
<p>Here are the most commonly mentioned streets in Austin’s novels.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="sentiment-analysis.html#cb32-1" tabindex="-1"></a><span class="co"># austin.2gram %&gt;%</span></span>
<span id="cb32-2"><a href="sentiment-analysis.html#cb32-2" tabindex="-1"></a><span class="co">#   separate(bigram, c(&quot;word1&quot;, &quot;word2&quot;), sep = &quot; &quot;) %&gt;%</span></span>
<span id="cb32-3"><a href="sentiment-analysis.html#cb32-3" tabindex="-1"></a><span class="co">#   filter(word2 == &quot;street&quot;) %&gt;%</span></span>
<span id="cb32-4"><a href="sentiment-analysis.html#cb32-4" tabindex="-1"></a><span class="co">#   count(book, word1, sort = TRUE)</span></span></code></pre></div>
<p>Use the TF-IDF statistic to compare words among documents. Calculate the cosine similarity, the angle in multidimensional space between two vectors (<span class="math inline">\(cos(\theta) = (A \cdot B) / ||A||||B||)\)</span>), to determine how similar two items are. Use <code>widyr::pairwise_similarity()</code> to calculate the cosine similarity of all pairs of items in a tidy table.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="sentiment-analysis.html#cb33-1" tabindex="-1"></a><span class="co"># austen %&gt;%</span></span>
<span id="cb33-2"><a href="sentiment-analysis.html#cb33-2" tabindex="-1"></a><span class="co">#   unnest_tokens(output = &quot;word&quot;, input = &quot;text&quot;, token = &quot;words&quot;) %&gt;%</span></span>
<span id="cb33-3"><a href="sentiment-analysis.html#cb33-3" tabindex="-1"></a><span class="co">#   anti_join(stop_words, by = &quot;word&quot;) %&gt;%</span></span>
<span id="cb33-4"><a href="sentiment-analysis.html#cb33-4" tabindex="-1"></a><span class="co">#   count(book, word) %&gt;%</span></span>
<span id="cb33-5"><a href="sentiment-analysis.html#cb33-5" tabindex="-1"></a><span class="co">#   bind_tf_idf(term = word, document = book, n = n) %&gt;%</span></span>
<span id="cb33-6"><a href="sentiment-analysis.html#cb33-6" tabindex="-1"></a><span class="co">#   pairwise_similarity(item = book, feature = word, value = tf_idf) %&gt;%</span></span>
<span id="cb33-7"><a href="sentiment-analysis.html#cb33-7" tabindex="-1"></a><span class="co">#   arrange(desc(similarity))</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="sentiment-analysis.html#cb34-1" tabindex="-1"></a><span class="co"># austen_books() %&gt;%</span></span>
<span id="cb34-2"><a href="sentiment-analysis.html#cb34-2" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;%</span></span>
<span id="cb34-3"><a href="sentiment-analysis.html#cb34-3" tabindex="-1"></a><span class="co">#   mutate(linenumber = row_number(),</span></span>
<span id="cb34-4"><a href="sentiment-analysis.html#cb34-4" tabindex="-1"></a><span class="co">#          chapter = cumsum(str_detect(text, regex(&quot;^chapter [\\divxlc]&quot;,</span></span>
<span id="cb34-5"><a href="sentiment-analysis.html#cb34-5" tabindex="-1"></a><span class="co">#                                                  ignore_case = TRUE)))) %&gt;%</span></span>
<span id="cb34-6"><a href="sentiment-analysis.html#cb34-6" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb34-7"><a href="sentiment-analysis.html#cb34-7" tabindex="-1"></a><span class="co">#   unnest_tokens(output = bigram, input = text, token = &quot;ngrams&quot;, n = 2) %&gt;%</span></span>
<span id="cb34-8"><a href="sentiment-analysis.html#cb34-8" tabindex="-1"></a><span class="co">#   separate(bigram, c(&quot;word1&quot;, &quot;word2&quot;), sep = &quot; &quot;) %&gt;%</span></span>
<span id="cb34-9"><a href="sentiment-analysis.html#cb34-9" tabindex="-1"></a><span class="co">#   filter(!word1 %in% stop_words$word &amp;</span></span>
<span id="cb34-10"><a href="sentiment-analysis.html#cb34-10" tabindex="-1"></a><span class="co">#            !word2 %in% stop_words$word &amp;</span></span>
<span id="cb34-11"><a href="sentiment-analysis.html#cb34-11" tabindex="-1"></a><span class="co">#            !is.na(word1) &amp; !is.na(word2)) %&gt;%</span></span>
<span id="cb34-12"><a href="sentiment-analysis.html#cb34-12" tabindex="-1"></a><span class="co">#   unite(bigram, word1, word2, sep = &quot; &quot;)</span></span>
<span id="cb34-13"><a href="sentiment-analysis.html#cb34-13" tabindex="-1"></a><span class="co"># austin.2gram %&gt;%</span></span>
<span id="cb34-14"><a href="sentiment-analysis.html#cb34-14" tabindex="-1"></a><span class="co">#   count(book, bigram) %&gt;%</span></span>
<span id="cb34-15"><a href="sentiment-analysis.html#cb34-15" tabindex="-1"></a><span class="co">#   bind_tf_idf(bigram, book, n) %&gt;%</span></span>
<span id="cb34-16"><a href="sentiment-analysis.html#cb34-16" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;%</span></span>
<span id="cb34-17"><a href="sentiment-analysis.html#cb34-17" tabindex="-1"></a><span class="co">#   top_n(n = 10, wt = tf_idf) %&gt;%</span></span>
<span id="cb34-18"><a href="sentiment-analysis.html#cb34-18" tabindex="-1"></a><span class="co">#   ggplot(aes(x = fct_reorder(bigram, n), y = tf_idf, fill = book)) +</span></span>
<span id="cb34-19"><a href="sentiment-analysis.html#cb34-19" tabindex="-1"></a><span class="co">#   geom_col(show.legend = FALSE) +</span></span>
<span id="cb34-20"><a href="sentiment-analysis.html#cb34-20" tabindex="-1"></a><span class="co">#   facet_wrap(~book, scales = &quot;free_y&quot;, ncol = 2) +</span></span>
<span id="cb34-21"><a href="sentiment-analysis.html#cb34-21" tabindex="-1"></a><span class="co">#   labs(y = &quot;tf-idf of bigram to novel&quot;) +</span></span>
<span id="cb34-22"><a href="sentiment-analysis.html#cb34-22" tabindex="-1"></a><span class="co">#   coord_flip() </span></span></code></pre></div>
<p>A good way to visualize bigrams is with a network graph. Packages <code>igraph</code> and <code>ggraph</code> provides tools for this purpose.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="sentiment-analysis.html#cb35-1" tabindex="-1"></a><span class="co"># set.seed(2016)</span></span>
<span id="cb35-2"><a href="sentiment-analysis.html#cb35-2" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-3"><a href="sentiment-analysis.html#cb35-3" tabindex="-1"></a><span class="co"># austen_books() %&gt;%</span></span>
<span id="cb35-4"><a href="sentiment-analysis.html#cb35-4" tabindex="-1"></a><span class="co">#   group_by(book) %&gt;%</span></span>
<span id="cb35-5"><a href="sentiment-analysis.html#cb35-5" tabindex="-1"></a><span class="co">#   mutate(linenumber = row_number(),</span></span>
<span id="cb35-6"><a href="sentiment-analysis.html#cb35-6" tabindex="-1"></a><span class="co">#          chapter = cumsum(str_detect(text, regex(&quot;^chapter [\\divxlc]&quot;,</span></span>
<span id="cb35-7"><a href="sentiment-analysis.html#cb35-7" tabindex="-1"></a><span class="co">#                                                  ignore_case = TRUE)))) %&gt;%</span></span>
<span id="cb35-8"><a href="sentiment-analysis.html#cb35-8" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb35-9"><a href="sentiment-analysis.html#cb35-9" tabindex="-1"></a><span class="co">#   unnest_tokens(output = bigram, input = text, token = &quot;ngrams&quot;, n = 2) %&gt;%</span></span>
<span id="cb35-10"><a href="sentiment-analysis.html#cb35-10" tabindex="-1"></a><span class="co">#   separate(bigram, c(&quot;word1&quot;, &quot;word2&quot;), sep = &quot; &quot;) %&gt;%</span></span>
<span id="cb35-11"><a href="sentiment-analysis.html#cb35-11" tabindex="-1"></a><span class="co">#   filter(!word1 %in% stop_words$word &amp;</span></span>
<span id="cb35-12"><a href="sentiment-analysis.html#cb35-12" tabindex="-1"></a><span class="co">#            !word2 %in% stop_words$word &amp;</span></span>
<span id="cb35-13"><a href="sentiment-analysis.html#cb35-13" tabindex="-1"></a><span class="co">#            !is.na(word1) &amp; !is.na(word2)) %&gt;%</span></span>
<span id="cb35-14"><a href="sentiment-analysis.html#cb35-14" tabindex="-1"></a><span class="co">#   count(word1, word2) %&gt;%</span></span>
<span id="cb35-15"><a href="sentiment-analysis.html#cb35-15" tabindex="-1"></a><span class="co">#   filter(n &gt; 20) %&gt;%</span></span>
<span id="cb35-16"><a href="sentiment-analysis.html#cb35-16" tabindex="-1"></a><span class="co">#   graph_from_data_frame() %&gt;%  # creates unformatted &quot;graph&quot;</span></span>
<span id="cb35-17"><a href="sentiment-analysis.html#cb35-17" tabindex="-1"></a><span class="co">#   ggraph(layout = &quot;fr&quot;) +</span></span>
<span id="cb35-18"><a href="sentiment-analysis.html#cb35-18" tabindex="-1"></a><span class="co">#   geom_edge_link(aes(edge_alpha = n), </span></span>
<span id="cb35-19"><a href="sentiment-analysis.html#cb35-19" tabindex="-1"></a><span class="co">#                  show.legend = FALSE,</span></span>
<span id="cb35-20"><a href="sentiment-analysis.html#cb35-20" tabindex="-1"></a><span class="co">#                  arrow = grid::arrow(type = &quot;closed&quot;, </span></span>
<span id="cb35-21"><a href="sentiment-analysis.html#cb35-21" tabindex="-1"></a><span class="co">#                                      length = unit(.15, &quot;inches&quot;)), </span></span>
<span id="cb35-22"><a href="sentiment-analysis.html#cb35-22" tabindex="-1"></a><span class="co">#                  end_cap = circle(.07, &#39;inches&#39;)) +</span></span>
<span id="cb35-23"><a href="sentiment-analysis.html#cb35-23" tabindex="-1"></a><span class="co">#   geom_node_point(color = &quot;lightblue&quot;, </span></span>
<span id="cb35-24"><a href="sentiment-analysis.html#cb35-24" tabindex="-1"></a><span class="co">#                   size = 5) +</span></span>
<span id="cb35-25"><a href="sentiment-analysis.html#cb35-25" tabindex="-1"></a><span class="co">#   geom_node_text(aes(label = name), vjust = 1, hjust = 1) +</span></span>
<span id="cb35-26"><a href="sentiment-analysis.html#cb35-26" tabindex="-1"></a><span class="co">#   theme_void()</span></span></code></pre></div>
<p>If you want to count the number of times that two words appear within the same document, or to see how correlated they are, widen the data with the <code>widyr</code> package.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="sentiment-analysis.html#cb36-1" tabindex="-1"></a><span class="co"># austen_books() %&gt;%</span></span>
<span id="cb36-2"><a href="sentiment-analysis.html#cb36-2" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb36-3"><a href="sentiment-analysis.html#cb36-3" tabindex="-1"></a><span class="co">#   mutate(section = row_number() %/% 10) %&gt;%</span></span>
<span id="cb36-4"><a href="sentiment-analysis.html#cb36-4" tabindex="-1"></a><span class="co">#   filter(section &gt; 0) %&gt;%</span></span>
<span id="cb36-5"><a href="sentiment-analysis.html#cb36-5" tabindex="-1"></a><span class="co">#   unnest_tokens(word, text) %&gt;%</span></span>
<span id="cb36-6"><a href="sentiment-analysis.html#cb36-6" tabindex="-1"></a><span class="co">#   filter(!word %in% stop_words$word) %&gt;%</span></span>
<span id="cb36-7"><a href="sentiment-analysis.html#cb36-7" tabindex="-1"></a><span class="co">#   pairwise_count(word, section, sort = TRUE)</span></span></code></pre></div>
<p>The correlation among words is how often they appear together relative to how often they appear separately. The phi coefficient is defined</p>
<p><span class="math display">\[\phi = \frac{n_{11}n_{00} - n_{10}n_{01}}{\sqrt{n_{1.}n_{0.}n_{.1}n_{.0}}}\]</span></p>
<p>where <span class="math inline">\(n_{10}\)</span> means number of times section has word x, but not word y, and <span class="math inline">\(n_{1.}\)</span> means total times section has word x. This lets us pick particular interesting words and find the other words most associated with them.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="sentiment-analysis.html#cb37-1" tabindex="-1"></a><span class="co"># austen_books() %&gt;%</span></span>
<span id="cb37-2"><a href="sentiment-analysis.html#cb37-2" tabindex="-1"></a><span class="co">#   filter(book == &quot;Pride &amp; Prejudice&quot;) %&gt;%</span></span>
<span id="cb37-3"><a href="sentiment-analysis.html#cb37-3" tabindex="-1"></a><span class="co">#   mutate(section = row_number() %/% 10) %&gt;%</span></span>
<span id="cb37-4"><a href="sentiment-analysis.html#cb37-4" tabindex="-1"></a><span class="co">#   filter(section &gt; 0) %&gt;%</span></span>
<span id="cb37-5"><a href="sentiment-analysis.html#cb37-5" tabindex="-1"></a><span class="co">#   unnest_tokens(word, text) %&gt;%</span></span>
<span id="cb37-6"><a href="sentiment-analysis.html#cb37-6" tabindex="-1"></a><span class="co">#   filter(!word %in% stop_words$word) %&gt;%</span></span>
<span id="cb37-7"><a href="sentiment-analysis.html#cb37-7" tabindex="-1"></a><span class="co">#   pairwise_cor(word, section, sort = TRUE) %&gt;%</span></span>
<span id="cb37-8"><a href="sentiment-analysis.html#cb37-8" tabindex="-1"></a><span class="co">#   filter(item1 %in% c(&quot;elizabeth&quot;, &quot;pounds&quot;, &quot;married&quot;, &quot;pride&quot;)) %&gt;%</span></span>
<span id="cb37-9"><a href="sentiment-analysis.html#cb37-9" tabindex="-1"></a><span class="co">#   group_by(item1) %&gt;%</span></span>
<span id="cb37-10"><a href="sentiment-analysis.html#cb37-10" tabindex="-1"></a><span class="co">#   top_n(n = 4) %&gt;%</span></span>
<span id="cb37-11"><a href="sentiment-analysis.html#cb37-11" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb37-12"><a href="sentiment-analysis.html#cb37-12" tabindex="-1"></a><span class="co">#   mutate(item2 = reorder(item2, correlation)) %&gt;%</span></span>
<span id="cb37-13"><a href="sentiment-analysis.html#cb37-13" tabindex="-1"></a><span class="co">#   ggplot(aes(x = item2, y = correlation)) +</span></span>
<span id="cb37-14"><a href="sentiment-analysis.html#cb37-14" tabindex="-1"></a><span class="co">#   geom_bar(stat = &quot;identity&quot;) +</span></span>
<span id="cb37-15"><a href="sentiment-analysis.html#cb37-15" tabindex="-1"></a><span class="co">#   facet_wrap(~ item1, scales = &quot;free&quot;) +</span></span>
<span id="cb37-16"><a href="sentiment-analysis.html#cb37-16" tabindex="-1"></a><span class="co">#   coord_flip()</span></span></code></pre></div>
<p>You can use the correlation to set a threshold for a graph.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="other-commands.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="text-classification-modeling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data-sci.pdf", "data-sci.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
